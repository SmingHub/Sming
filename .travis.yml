sudo: false
language: cpp
install:  
  - mkdir -p $TRAVIS_BUILD_DIR/opt/esp-open-sdk
  - wget https://bintray.com/artifact/download/kireevco/generic/esp-open-sdk-1.2-linux-x86_64.tar.gz
  - tar -zxf esp-open-sdk-1.2-linux-x86_64.tar.gz -C $TRAVIS_BUILD_DIR/opt/esp-open-sdk
  - export PATH=$PATH:$TRAVIS_BUILD_DIR/opt/esp-open-sdk/sdk:$TRAVIS_BUILD_DIR/opt/esp-open-sdk/xtensa-lx106-elf/bin
  - export SMING_HOME=$TRAVIS_BUILD_DIR/Sming
  - export ESP_HOME=$TRAVIS_BUILD_DIR/opt/esp-open-sdk
script:

# Get a list of all modified, added or deleted files and run make in those projects
- export CHANGED_FILES=`git diff --diff-filter=AMD HEAD HEAD^ --name-only`
# Get unique project directories
- export CHANGED_PROJECTS=`for i in $CHANGED_FILES; do echo "$i" | cut -d'/' -f1; done | uniq`
# Make Sming initially
- cd Sming
- make
# And then make all changed projects
- for i in $CHANGED_PROJECTS; do if [ "$i" == "Sming" ]; then continue; fi; echo "Compiling $i"; cd "$i"; make; done 
