<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>Sming Framework API: rBoot API</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Sming Framework API
   </div>
   <div id="projectbrief">Sming - Open Source framework for high efficiency WiFi SoC ESP8266 native development with C++ language.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__rboot.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">rBoot API</div>  </div>
</div><!--header-->
<div class="contents">

<p>rBoot for ESP8266 API allows runtime code to access the rBoot configuration. Configuration may be read to use within the main firmware or updated to affect next boot behavior.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structrboot__write__status.html">rboot_write_status</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Structure defining flash write status.  <a href="structrboot__write__status.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structrboot__config.html">rboot_config</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Structure containing rBoot configuration.  <a href="structrboot__config.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga75cf4cee5db4ed4786099422a55984d1"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structrboot__config.html">rboot_config</a> ICACHE_FLASH_ATTR&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rboot.html#ga75cf4cee5db4ed4786099422a55984d1">rboot_get_config</a> (void)</td></tr>
<tr class="memdesc:ga75cf4cee5db4ed4786099422a55984d1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read rBoot configuration from flash.  <a href="#ga75cf4cee5db4ed4786099422a55984d1">More...</a><br/></td></tr>
<tr class="separator:ga75cf4cee5db4ed4786099422a55984d1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga7805faa263e4abf0206440d1f7e9f827"><td class="memItemLeft" align="right" valign="top">bool ICACHE_FLASH_ATTR&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rboot.html#ga7805faa263e4abf0206440d1f7e9f827">rboot_set_config</a> (<a class="el" href="structrboot__config.html">rboot_config</a> *conf)</td></tr>
<tr class="memdesc:ga7805faa263e4abf0206440d1f7e9f827"><td class="mdescLeft">&#160;</td><td class="mdescRight">Write rBoot configuration to flash memory.  <a href="#ga7805faa263e4abf0206440d1f7e9f827">More...</a><br/></td></tr>
<tr class="separator:ga7805faa263e4abf0206440d1f7e9f827"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga17b7d31988c48928f467590f556aea7e"><td class="memItemLeft" align="right" valign="top">uint8 ICACHE_FLASH_ATTR&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rboot.html#ga17b7d31988c48928f467590f556aea7e">rboot_get_current_rom</a> (void)</td></tr>
<tr class="memdesc:ga17b7d31988c48928f467590f556aea7e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get index of current ROM.  <a href="#ga17b7d31988c48928f467590f556aea7e">More...</a><br/></td></tr>
<tr class="separator:ga17b7d31988c48928f467590f556aea7e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaab5159500a674aef9623dc47dc93f2f0"><td class="memItemLeft" align="right" valign="top">bool ICACHE_FLASH_ATTR&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rboot.html#gaab5159500a674aef9623dc47dc93f2f0">rboot_set_current_rom</a> (uint8 rom)</td></tr>
<tr class="memdesc:gaab5159500a674aef9623dc47dc93f2f0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set the index of current ROM.  <a href="#gaab5159500a674aef9623dc47dc93f2f0">More...</a><br/></td></tr>
<tr class="separator:gaab5159500a674aef9623dc47dc93f2f0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga672bde83ee304516d380f671cefa64cb"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structrboot__write__status.html">rboot_write_status</a> <br class="typebreak"/>
ICACHE_FLASH_ATTR&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rboot.html#ga672bde83ee304516d380f671cefa64cb">rboot_write_init</a> (uint32 start_addr)</td></tr>
<tr class="memdesc:ga672bde83ee304516d380f671cefa64cb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialise flash write process.  <a href="#ga672bde83ee304516d380f671cefa64cb">More...</a><br/></td></tr>
<tr class="separator:ga672bde83ee304516d380f671cefa64cb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga94db8cff03700f2c7c3f16885a8d1ee9"><td class="memItemLeft" align="right" valign="top">bool ICACHE_FLASH_ATTR&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rboot.html#ga94db8cff03700f2c7c3f16885a8d1ee9">rboot_write_end</a> (<a class="el" href="structrboot__write__status.html">rboot_write_status</a> *status)</td></tr>
<tr class="memdesc:ga94db8cff03700f2c7c3f16885a8d1ee9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Complete flash write process.  <a href="#ga94db8cff03700f2c7c3f16885a8d1ee9">More...</a><br/></td></tr>
<tr class="separator:ga94db8cff03700f2c7c3f16885a8d1ee9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaeb9288ddc892ba1f858689601881faf5"><td class="memItemLeft" align="right" valign="top">bool ICACHE_FLASH_ATTR&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rboot.html#gaeb9288ddc892ba1f858689601881faf5">rboot_write_flash</a> (<a class="el" href="structrboot__write__status.html">rboot_write_status</a> *status, uint8 *data, uint16 len)</td></tr>
<tr class="memdesc:gaeb9288ddc892ba1f858689601881faf5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Write data to flash memory.  <a href="#gaeb9288ddc892ba1f858689601881faf5">More...</a><br/></td></tr>
<tr class="separator:gaeb9288ddc892ba1f858689601881faf5"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>rBoot for ESP8266 API allows runtime code to access the rBoot configuration. Configuration may be read to use within the main firmware or updated to affect next boot behavior. </p>
<dl class="section copyright"><dt>Copyright</dt><dd>2015 Richard A Burton </dd></dl>
<dl class="section author"><dt>Author</dt><dd><a href="#" onclick="location.href='mai'+'lto:'+'ric'+'ha'+'rda'+'bu'+'rto'+'n@'+'gma'+'il'+'.co'+'m'; return false;">richa<span style="display: none;">.nosp@m.</span>rdab<span style="display: none;">.nosp@m.</span>urton<span style="display: none;">.nosp@m.</span>@gma<span style="display: none;">.nosp@m.</span>il.co<span style="display: none;">.nosp@m.</span>m</a> </dd>
<dd>
OTA code based on SDK sample from Espressif </dd></dl>
<dl class="section user"><dt>License:</dt><dd>See licence.txt for license terms. </dd></dl>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="ga75cf4cee5db4ed4786099422a55984d1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structrboot__config.html">rboot_config</a> ICACHE_FLASH_ATTR rboot_get_config </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Read rBoot configuration from flash. </p>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname"><a class="el" href="structrboot__config.html" title="Structure containing rBoot configuration. ">rboot_config</a></td><td>Copy of the rBoot configuration </td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>Returns <a class="el" href="structrboot__config.html" title="Structure containing rBoot configuration. ">rboot_config</a> (defined in <a class="el" href="rboot_8h_source.html">rboot.h</a>) allowing you to modify any values in it, including the ROM layout. </dd></dl>

</div>
</div>
<a class="anchor" id="ga17b7d31988c48928f467590f556aea7e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8 ICACHE_FLASH_ATTR rboot_get_current_rom </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get index of current ROM. </p>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">uint8</td><td>Index of the current ROM </td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>Get the currently selected boot ROM (this will be the currently running ROM, as long as you haven't changed it since boot or rBoot booted the rom in temporary boot mode, see rboot_get_last_boot_rom). </dd></dl>

</div>
</div>
<a class="anchor" id="ga7805faa263e4abf0206440d1f7e9f827"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool ICACHE_FLASH_ATTR rboot_set_config </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structrboot__config.html">rboot_config</a> *&#160;</td>
          <td class="paramname"><em>conf</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Write rBoot configuration to flash memory. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">conf</td><td>pointer to a <a class="el" href="structrboot__config.html" title="Structure containing rBoot configuration. ">rboot_config</a> structure containing configuration to save </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">bool</td><td>True on success </td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>Saves the <a class="el" href="structrboot__config.html" title="Structure containing rBoot configuration. ">rboot_config</a> structure back to configuration sector (BOOT_CONFIG_SECTOR) of the flash, while maintaining the contents of the rest of the sector. You can use the rest of this sector for your app settings, as long as you protect this structure when you do so. </dd></dl>

</div>
</div>
<a class="anchor" id="gaab5159500a674aef9623dc47dc93f2f0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool ICACHE_FLASH_ATTR rboot_set_current_rom </td>
          <td>(</td>
          <td class="paramtype">uint8&#160;</td>
          <td class="paramname"><em>rom</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set the index of current ROM. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">rom</td><td>The index of the ROM to use on next boot </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">bool</td><td>True on success </td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>Set the current boot ROM, which will be used when next restarted. </dd>
<dd>
This function re-writes the whole configuration to flash memory (not just the current ROM index) </dd></dl>

</div>
</div>
<a class="anchor" id="ga94db8cff03700f2c7c3f16885a8d1ee9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool ICACHE_FLASH_ATTR rboot_write_end </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structrboot__write__status.html">rboot_write_status</a> *&#160;</td>
          <td class="paramname"><em>status</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Complete flash write process. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">status</td><td>Pointer to <a class="el" href="structrboot__write__status.html" title="Structure defining flash write status. ">rboot_write_status</a> structure defining the write status </td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>Call at the completion of flash writing. This ensures any outstanding bytes are written (if data so far hasn't been a multiple of 4 bytes there will be a few bytes unwritten, until you call this function). </dd></dl>

</div>
</div>
<a class="anchor" id="gaeb9288ddc892ba1f858689601881faf5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool ICACHE_FLASH_ATTR rboot_write_flash </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structrboot__write__status.html">rboot_write_status</a> *&#160;</td>
          <td class="paramname"><em>status</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8 *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16&#160;</td>
          <td class="paramname"><em>len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Write data to flash memory. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">status</td><td>Pointer to <a class="el" href="structrboot__write__status.html" title="Structure defining flash write status. ">rboot_write_status</a> structure defining the write status </td></tr>
    <tr><td class="paramname">data</td><td>Pointer to a block of uint8 data elements to be written to flash </td></tr>
    <tr><td class="paramname">len</td><td>Quantity of uint8 data elements to write to flash </td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>Call repeatedly to write data to the flash, starting at the address specified on the prior call to rboot_write_init. Current write position is tracked automatically. This method is likely to be called each time a packet of OTA data is received over the network. </dd>
<dd>
Call rboot_write_init before calling this function to get the <a class="el" href="structrboot__write__status.html" title="Structure defining flash write status. ">rboot_write_status</a> structure </dd></dl>

</div>
</div>
<a class="anchor" id="ga672bde83ee304516d380f671cefa64cb"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structrboot__write__status.html">rboot_write_status</a> ICACHE_FLASH_ATTR rboot_write_init </td>
          <td>(</td>
          <td class="paramtype">uint32&#160;</td>
          <td class="paramname"><em>start_addr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialise flash write process. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">start_addr</td><td>Address on the SPI flash to begin write to </td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>Call once before starting to pass data to write to flash memory with rboot_write_flash function. start_addr is the address on the SPI flash to write from. Returns a status structure which must be passed back on each write. The contents of the structure should not be modified by the calling code. </dd></dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
