#
# Makefile for spiffy
#

HOST_CC ?= gcc
HOST_LD ?= gcc
ENABLE_SPIFFS_TREE ?=0

INCDIR := -I$(SMING_HOME)/Services/SpifFS -I$(SMING_HOME)/third-party/spiffs/src
CFLAGS := -O2 -Wall -Wno-unused-value -DENABLE_SPIFFS_TREE=$(ENABLE_SPIFFS_TREE)

ifeq ("$(V)","1")
Q :=
vecho := @true
else
Q := @
vecho := @echo
endif

all: spiffy

%.o: $(SMING_HOME)/Services/SpifFS/%.c
	$(vecho) "CC $<"
	$(Q) $(HOST_CC) $(CFLAGS) $(INCDIR) -c $< -o $@
	
%.o: $(SMING_HOME)/third-party/spiffs/src/%.c
	$(vecho) "CC $<"
	$(Q) $(HOST_CC) $(CFLAGS) $(INCDIR) -c $< -o $@

spiffy.o: spiffy.c
	$(vecho) "CC $<"
	$(Q) $(HOST_CC) $(CFLAGS) $(INCDIR) -c $< -o $@

spiffy: spiffy.o spiffs_cache.o spiffs_nucleus.o spiffs_hydrogen.o spiffs_gc.o spiffs_check.o
	$(vecho) "LD $@"
	$(Q) $(HOST_LD) -o $@ $^

clean:
	$(Q) rm -f *.o
	$(Q) rm -f spiffy spiffy.exe
